# CS1016 200 mV Range Issue - Current Status

## Проблема

При выборе диапазона "200 mV" для канала:
- ✅ Команда `:ROUT:CHAN1,ON,DCV,200mV,FAST` **принимается** устройством (код ошибки 0,"No Error")
- ❌ Мультиметр **пищит и показывает ошибку** "CSPI Execution Error"
- ❌ Измерения не выполняются

При выборе диапазона "AUTO":
- ✅ Мультиметр выбирает режим "Auto200mV"
- ✅ Измерения выполняются корректно

При выборе диапазона "2 A" для канала 13-16:
- ✅ Команда `:ROUT:CHAN13,ON,DCA,2A,FAST` работает корректно
- ✅ Нет ошибок в логах

## Текущий код

### Изменённые файлы:

1. **[`hardware/visa_interface.py`](hardware/visa_interface.py:189-215)**
   - Добавлена задержка 1 секунду между настройками каналов
   - Добавлена проверка ошибок после настройки каждого канала
   - **В словаре `RANGE_TO_SCPI`**:
     - Диапазон "200 mV" **удалён**
     - Добавлено примечание: "NOTE: "200 mV" range is NOT SUPPORTED by CS1016 scanning card - causes "CSPI Execution Error""

2. **[`gui/widgets.py`](gui/widgets.py:222-230)**
   - Обновлён `VALID_RANGES` - диапазон "200 mV" удалён из списка поддерживаемых диапазонов
   - Обновлён `RANGE_TO_UNIT` - диапазон "200 mV" удалён
   - Обновлён `RANGE_TO_CONVERSION` - диапазон "200 mV" удалён

3. **[`config/config_loader.py`](config/config_loader.py:68-81)**
   - Обновлён `VALID_RANGES` - диапазон "200 mV" удалён из списка поддерживаемых диапазонов

4. **[`doc/CS1016_Supported_Ranges.md`](doc/CS1016_Supported_Ranges.md)** - создан
   - Подробная информация о поддерживаемых диапазонах

5. **[`doc/CS1016_200mV_Debug_Guide.md`](doc/CS1016_200mV_Debug_Guide.md)** - создан
   - Гайд по диагностике

6. **[`doc/CS1016_Range_Fix_Summary.md`](doc/CS1016_Range_Fix_Summary.md)** - создан
   - Обзор изменений

## Анализ проблемы

### Что известно:

1. **Диапазон "200 mV" поддерживается CS1016 картой** (есть в документации)
2. **Команда технически принимается** устройством (код ошибки 0,"No Error")
3. **Мультиметр пищит и показывает ошибку** сразу после приёма команды
4. **В AUTO режиме мультиметр работает корректно**
5. **Другие диапазоны (2 V, 20 V, 200 V) работают корректно**
6. **Диапазон "2 A" для тока работает корректно**

### Возможные причины:

1. **Диапазон "200 mV" несовместим с CS1016 картой**
   - Хотя он указан в документации как поддерживаемый, мультиметр не может использовать его при сканировании
   - Возможно, мультиметр пытается переключиться на этот диапазон, но не может, и это вызывает ошибку

2. **Особенность устройства или прошивки**
   - Возможно, SDM4055A-SC имеет особенность, которая делает диапазон "200 mV" неработоспособным

3. **Проблема синхронизации**
   - Возможно, мультиметру нужно больше времени для переключения на этот диапазон
   - Возможно, нужны дополнительные команды для настройки диапазона

## Что было сделано для решения:

### ✅ Удалён неподдерживаемые диапазоны из UI
- Диапазон "200 mV" удалён из выпадающих списков
- Пользователь больше не может выбрать этот диапазон

### ✅ Добавлена проверка ошибок
- После настройки каждого канала выполняется запрос `:SYST:ERR?`
- Это позволяет обнаружить проблемы с конфигурацией

### ✅ Добавлена задержка 1 секунду
- Между настройками каналов добавлена задержка 1 секунду для стабилизации

### ✅ Создана документация
- Подробная информация о поддерживаемых диапазонах
- Гайды по диагностике

## Текущий статус

**Проблема НЕ решена** - диапазон "200 mV" всё ещё вызывает ошибку, хотя он технически принимается устройством.

## Что нужно сделать:

### Вариант 1: Используйте AUTO
- Выберите "AUTO" вместо "200 mV"
- Мультиметр автоматически выберет подходящий диапазон

### Вариант 2: Используйте другие диапазоны
- Попробуйте использовать диапазон "2 V" вместо "200 mV"
- Этот диапазон также поддерживается и должен работать

### Вариант 3: Свяжитесь с производителем
- Это может быть известная проблема с SDM4055A-SC и CS1016 картой
- Проверьте, есть ли обновления прошивки
- Свяжитесь с технической поддержкой Siglent

### Вариант 4: Обратитесь к документации
- Проверьте официальную документацию Siglent по CS1016
- Возможно, есть особые требования для использования диапазона "200 mV"

## Рекомендации для пользователя:

1. **Не используйте диапазон "200 mV"**
   - Этот диапазон вызывает ошибку "CSPI Execution Error"
   - Используйте AUTO или другие поддерживаемые диапазоны

2. **Перезапустите приложение**
   - После изменения кода перезапустите приложение
   - Проверьте, помогла ли задержка 1 секунду

3. **Проверьте логи**
   - Посмотрите на сообщения "Channel X configuration error:"
   - Если видите это сообщение, значит проверка ошибок работает

4. **Предоставьте подробную информацию**
   - Если проблема сохраняется, уточните:
     - Точное сообщение об ошибке на дисплее мультиметра
     - Работают ли другие диапазоны корректно?
     - Пищит ли мультиметр только при выборе диапазона или постоянно?

---

**Дата создания:** 2026-01-16
**Статус:** Диапазон "200 mV" вызывает ошибку. Причина не установлена. Пользователь должен использовать AUTO или другие диапазоны.
